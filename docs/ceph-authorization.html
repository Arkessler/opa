
<!DOCTYPE HTML>
<html lang="">
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Ceph Authorization &#xB7; GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-ace/ace.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

    

        
    
    
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="best-practice-identity.html">
    
    
    <link rel="prev" href="terraform.html">
    

    </head>
    <body>
        
<div class="book"><div class="_doc--header">
  <div class="header _doc--container">

      <div class="_doc--logo header--logo">
        <a class="header--logo-link" href="/">
          <img class="header--logo-image" src="images/opa-logo.svg" alt="">
          <p class="header--logo-txt">
            Open Policy Agent
          </p>
        </a>
      </div>

      <div class="_doc--menu-mobile">
        <button class="hamburger hamburger--spring" type="button" style="outline: none; padding-bottom: 8px;">
          <span class=" hamburger-box">
            <span class="menu-mobile--hamburger-inner hamburger-inner"></span>
          </span>
        </button>
      </div>

      <div class="_doc--menu-desktop header--menu">
        <a class="header--link header--link_LONG" href="/docs/">
          <p class="header--menu-txt">
            Documentation
          </p>
        </a>
        <a class="header--link header--link_LONG" href="/docs/get-started.html">
          <p class="header--menu-txt">
            Tutorials
          </p>
        </a>
        <a class="header--link header--link_LONG" href="https://play.openpolicyagent.org/" target="_blank">
          <p class="header--menu-txt">
            Playground
          </p>
        </a>
        <a class="header--link header--social-link" href="https://blog.openpolicyagent.org/" target="_blank">
          <img class="header--menu-image" src="images/Medium.svg" alt="">
        </a>
        <a class="header--link header--social-link" href="https://github.com/open-policy-agent/opa" target="_blank">
          <img class="header--menu-image" src="images/Github.svg" alt="">
        </a>
        <a class="header--link header--social-link" href="http://slack.openpolicyagent.org" target="_blank">
          <img class="header--menu-image" src="images/Slack.svg" alt="">
        </a>
      </div>

  </div>
</div>

<div class="_doc--hamburger-menu-container">

  <a class="header--hamburger-menu-link" href="/docs">
    <li class="header--hamburger-menu-item">
      <p class="header--menu-txt">
        Documentation
      </p>
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="/docs/get-started.html">
    <li class="header--hamburger-menu-item">
      <p class="header--menu-txt">
        Tutorials
      </p>
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="https://blog.openpolicyagent.org/" target="_blank">
    <li class="header--hamburger-menu-item">
      <img class="header--menu-image" src="images/Medium.svg" alt="">
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="https://github.com/open-policy-agent/opa" target="_blank">
    <li class="header--hamburger-menu-item">
      <img class="header--menu-image" src="images/Github.svg" alt="">
    </li>
  </a>

  <a class="header--hamburger-menu-link" href="http://slack.openpolicyagent.org/" target="_blank">
    <li class="header--hamburger-menu-item">
      <img class="header--menu-image" src="images/Slack.svg" alt="">
    </li>
  </a>


</div>

    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="./">
            
                <a href="./#what-is-policy">
            
                    
                    What is Policy?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="./">
            
                <a href="./#what-is-policy-enablement">
            
                    
                    What is Policy Enablement?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="./">
            
                <a href="./#what-is-opa">
            
                    
                    What is OPA?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="./">
            
                <a href="./#why-use-opa">
            
                    
                    Why use OPA?
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html">
            
                    
                    How Does OPA Work?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#overview">
            
                    
                    Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#deployment">
            
                    
                    Deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#data-and-policies">
            
                    
                    Data and Policies
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#base-documents">
            
                    
                    Base Documents
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#policies">
            
                    
                    Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#rules-and-virtual-documents">
            
                    
                    Rules and Virtual Documents
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#the-data-document">
            
                    
                    The data Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#the-input-document">
            
                    
                    The input Document
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="how-does-opa-work.html">
            
                <a href="how-does-opa-work.html#putting-it-all-together">
            
                    
                    Putting It All Together
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html">
            
                    
                    How Do I Write Policies?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#what-is-rego">
            
                    
                    What is Rego?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#why-use-rego">
            
                    
                    Why use Rego?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#the-basics">
            
                    
                    The Basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#scalar-values">
            
                    
                    Scalar Values
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#composite-values">
            
                    
                    Composite Values
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#sets">
            
                    
                    Sets
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#variables">
            
                    
                    Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#references">
            
                    
                    References
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#variable-keys">
            
                    
                    Variable Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#multiple-expressions">
            
                    
                    Multiple Expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#self-joins">
            
                    
                    Self-Joins
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#comprehensions">
            
                    
                    Comprehensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.8.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#array-comprehensions">
            
                    
                    Array Comprehensions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#object-comprehensions">
            
                    
                    Object Comprehensions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#set-comprehensions">
            
                    
                    Set Comprehensions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#rules">
            
                    
                    Rules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.9.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#generating-sets">
            
                    
                    Generating Sets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#generating-objects">
            
                    
                    Generating Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#incremental-definitions">
            
                    
                    Incremental Definitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9.4" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#complete-definitions">
            
                    
                    Complete Definitions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#functions">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#negation">
            
                    
                    Negation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#modules">
            
                    
                    Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.12.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#comments">
            
                    
                    Comments
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#imports">
            
                    
                    Imports
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#with-keyword">
            
                    
                    With Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#default-keyword">
            
                    
                    Default Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#else-keyword">
            
                    
                    Else Keyword
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#operators">
            
                    
                    Operators
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.16.1" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#equality">
            
                    
                    Equality
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16.2" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#assignment">
            
                    
                    Assignment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16.3" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#comparison">
            
                    
                    Comparison
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.17" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#built-in-functions">
            
                    
                    Built-in Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.18" data-path="how-do-i-write-policies.html">
            
                <a href="how-do-i-write-policies.html#example-data">
            
                    
                    Example Data
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html">
            
                    
                    How Do I Test Policies?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#getting-started">
            
                    
                    Getting Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#test-format">
            
                    
                    Test Format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#test-discovery">
            
                    
                    Test Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#test-results">
            
                    
                    Test Results
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#data-mocking">
            
                    
                    Data Mocking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#coverage">
            
                    
                    Coverage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="how-do-i-test-policies.html">
            
                <a href="how-do-i-test-policies.html#profiling">
            
                    
                    Profiling
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="language-reference.html">
            
                <a href="language-reference.html">
            
                    
                    Language Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="language-reference.html">
            
                <a href="language-reference.html#built-in-functions">
            
                    
                    Built-in Functions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1.1" data-path="language-reference.html">
            
                <a href="language-reference.html#comparison">
            
                    
                    Comparison
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.2" data-path="language-reference.html">
            
                <a href="language-reference.html#numbers">
            
                    
                    Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.3" data-path="language-reference.html">
            
                <a href="language-reference.html#aggregates">
            
                    
                    Aggregates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.4" data-path="language-reference.html">
            
                <a href="language-reference.html#sets">
            
                    
                    Sets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.5" data-path="language-reference.html">
            
                <a href="language-reference.html#strings">
            
                    
                    Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.6" data-path="language-reference.html">
            
                <a href="language-reference.html#types">
            
                    
                    Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.7" data-path="language-reference.html">
            
                <a href="language-reference.html#encoding">
            
                    
                    Encoding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.8" data-path="language-reference.html">
            
                <a href="language-reference.html#tokens">
            
                    
                    Tokens
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.1.9" data-path="language-reference.html">
            
                <a href="language-reference.html#time">
            
                    
                    Time
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="language-reference.html">
            
                <a href="language-reference.html#reserved-names">
            
                    
                    Reserved Names
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="language-reference.html">
            
                <a href="language-reference.html#grammar">
            
                    
                    Grammar
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="configuration.html">
            
                <a href="configuration.html">
            
                    
                    Configuration Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="configuration.html">
            
                <a href="configuration.html#example">
            
                    
                    Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="configuration.html">
            
                <a href="configuration.html#services">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="configuration.html">
            
                <a href="configuration.html#miscellaenous">
            
                    
                    Miscellaneous
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="configuration.html">
            
                <a href="configuration.html#bundles">
            
                    
                    Bundles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="configuration.html">
            
                <a href="configuration.html#status">
            
                    
                    Status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="configuration.html">
            
                <a href="configuration.html#decision-logs">
            
                    
                    Decision Logs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="configuration.html">
            
                <a href="configuration.html#discovery">
            
                    
                    Discovery
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="rest-api.html">
            
                <a href="rest-api.html">
            
                    
                    REST API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="rest-api.html">
            
                <a href="rest-api.html#policy-api">
            
                    
                    Policy API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1.1" data-path="rest-api.html">
            
                <a href="rest-api.html#list-policies">
            
                    
                    List Policies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.1.2" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-policy">
            
                    
                    Get a Policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.1.3" data-path="rest-api.html">
            
                <a href="rest-api.html#create-or-update-a-policy">
            
                    
                    Create or Update a Policy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.1.4" data-path="rest-api.html">
            
                <a href="rest-api.html#delete-a-policy">
            
                    
                    Delete a Policy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="rest-api.html">
            
                <a href="rest-api.html#data-api">
            
                    
                    Data API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.2.1" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-document">
            
                    
                    Get a Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.2" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-document-with-input">
            
                    
                    Get a Document (with Input)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.3" data-path="rest-api.html">
            
                <a href="rest-api.html#get-a-document-webhook">
            
                    
                    Get a Document (Webhook)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.4" data-path="rest-api.html">
            
                <a href="rest-api.html#create-or-overwrite-a-document">
            
                    
                    Create or Overwrite a Document
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2.5" data-path="rest-api.html">
            
                <a href="rest-api.html#patch-a-document">
            
                    
                    Patch a Document
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="rest-api.html">
            
                <a href="rest-api.html#query-api">
            
                    
                    Query API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.3.1" data-path="rest-api.html">
            
                <a href="rest-api.html#execute-a-simple-query">
            
                    
                    Execute a Simple Query
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3.2" data-path="rest-api.html">
            
                <a href="rest-api.html#execute-an-ad-hoc-query">
            
                    
                    Execute an Ad-hoc Query
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="rest-api.html">
            
                <a href="rest-api.html#compile-api">
            
                    
                    Compile API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.4.1" data-path="rest-api.html">
            
                <a href="rest-api.html#partially-evaluate-a-query">
            
                    
                    Partially Evaluate a Query
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="rest-api.html">
            
                <a href="rest-api.html#authentication">
            
                    
                    Authentication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.5.1" data-path="rest-api.html">
            
                <a href="rest-api.html#bearer-tokens">
            
                    
                    Bearer Tokens
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="rest-api.html">
            
                <a href="rest-api.html#errors">
            
                    
                    Errors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="rest-api.html">
            
                <a href="rest-api.html#explanations">
            
                    
                    Explanations
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.7.1" data-path="rest-api.html">
            
                <a href="rest-api.html#trace-events">
            
                    
                    Trace Events
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="rest-api.html">
            
                <a href="rest-api.html#performance-metrics">
            
                    
                    Performance Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="rest-api.html">
            
                <a href="rest-api.html#watches">
            
                    
                    Watches
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="deployments.html">
            
                <a href="deployments.html">
            
                    
                    Deployments
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="deployments.html">
            
                <a href="deployments.html#docker">
            
                    
                    Docker
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1.1" data-path="deployments.html">
            
                <a href="deployments.html#running-with-docker">
            
                    
                    Running with Docker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="deployments.html">
            
                <a href="deployments.html#kubernetes">
            
                    
                    Kubernetes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.2.1" data-path="deployments.html">
            
                <a href="deployments.html#kicking-the-tires">
            
                    
                    Kicking the Tires
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="bundles.html">
            
                <a href="bundles.html">
            
                    
                    Bundles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="bundles.html">
            
                <a href="bundles.html#bundle-service-api">
            
                    
                    Service API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="bundles.html">
            
                <a href="bundles.html#bundle-file-format">
            
                    
                    File Format
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="bundles.html">
            
                <a href="bundles.html#multiple-sources-of-policy-and-data">
            
                    
                    Multiple Sources
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="status.html">
            
                <a href="status.html">
            
                    
                    Status
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="status.html">
            
                <a href="status.html#status-service-api">
            
                    
                    Service API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="decision_logs.html">
            
                <a href="decision_logs.html">
            
                    
                    Decision Logs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="decision_logs.html">
            
                <a href="decision_logs.html#decision-log-service-api">
            
                    
                    Service API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="monitoring.html">
            
                <a href="monitoring.html">
            
                    
                    Monitoring
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="monitoring.html">
            
                <a href="monitoring.html#prometheus">
            
                    
                    Prometheus
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="discovery.html">
            
                <a href="discovery.html">
            
                    
                    Discovery
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="discovery.html">
            
                <a href="discovery.html#discovery-service-api">
            
                    
                    Service API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="discovery.html">
            
                <a href="discovery.html#example">
            
                    
                    Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="discovery.html">
            
                <a href="discovery.html#limitations">
            
                    
                    Limitations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="security.html">
            
                <a href="security.html">
            
                    
                    Security
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="security.html">
            
                <a href="security.html#tls-and-https">
            
                    
                    TLS and HTTPS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="security.html">
            
                <a href="security.html#authentication-and-authorization">
            
                    
                    Authentication and Authorization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="faq.html">
            
                <a href="faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="comparison-to-other-systems.html">
            
                <a href="comparison-to-other-systems.html">
            
                    
                    Comparison to Other Systems
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="comparison-to-other-systems.html">
            
                <a href="comparison-to-other-systems.html#role-based-access-control-rbac">
            
                    
                    RBAC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.2" data-path="comparison-to-other-systems.html">
            
                <a href="comparison-to-other-systems.html#attribute-based-access-control-abac">
            
                    
                    ABAC
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.3" data-path="comparison-to-other-systems.html">
            
                <a href="comparison-to-other-systems.html#amazon-web-services-iam">
            
                    
                    AWS IAM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17.4" data-path="comparison-to-other-systems.html">
            
                <a href="comparison-to-other-systems.html#xacml">
            
                    
                    XACML
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Tutorials</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="get-started.html">
            
                <a href="get-started.html">
            
                    
                    Get Started
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="docker-authorization.html">
            
                <a href="docker-authorization.html">
            
                    
                    Docker Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="http-api-authorization.html">
            
                <a href="http-api-authorization.html">
            
                    
                    HTTP API Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="ssh-and-sudo-authorization.html">
            
                <a href="ssh-and-sudo-authorization.html">
            
                    
                    SSH and sudo Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="kafka-authorization.html">
            
                <a href="kafka-authorization.html">
            
                    
                    Kafka Authorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="kubernetes-admission-control.html">
            
                <a href="kubernetes-admission-control.html">
            
                    
                    Kubernetes Admission Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="terraform.html">
            
                <a href="terraform.html">
            
                    
                    Terraform Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.8" data-path="ceph-authorization.html">
            
                <a href="ceph-authorization.html">
            
                    
                    Ceph Authorization
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Best Practices</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="best-practice-identity.html">
            
                <a href="best-practice-identity.html">
            
                    
                    Identity and User attributes
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".">Ceph Authorization</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="ceph-authorization">Ceph Authorization</h1>
<p>Ceph is a highly scalable distributed storage solution that uniquely delivers object, block, and file storage in one unified system. You can enforce fine-grained authorization over Ceph&apos;s Object Storage using OPA. Ceph&apos;s Object Storage essentially consists of a <a href="http://docs.ceph.com/docs/nautilus/rados/#" target="_blank">Ceph Storage Cluster</a> and a <a href="http://docs.ceph.com/docs/nautilus/radosgw/" target="_blank">Ceph Object Gateway</a>.</p>
<p>The <code>Ceph Object Gateway</code> is an object storage interface built on top of <a href="http://docs.ceph.com/docs/nautilus/rados/api/librados-intro/" target="_blank">librados</a> to provide applications with a RESTful gateway to Ceph Storage Clusters.</p>
<p>OPA is integrated with the <code>Ceph Object Gateway daemon (RGW)</code>, which is an HTTP server that interacts with a <code>Ceph Storage Cluster</code> and provides interfaces compatible with <code>OpenStack Swift</code> and <code>Amazon S3</code>.</p>
<p>When the <code>Ceph Object Gateway</code> gets a request, it checks with OPA whether the request should be allowed or not. OPA makes a decision (<code>allow</code> or <code>deny</code>) based on the policies and data it has access to and sends the decision back to the <code>Ceph Object Gateway</code> for enforcement.</p>
<h2 id="goals">Goals</h2>
<p>This tutorial shows how to enforce custom policies over the S3 API to the <code>Ceph Storage Cluster</code> which applications use to put and get data.</p>
<p>This tutorial uses <a href="https://rook.io/" target="_blank">Rook</a> to run Ceph inside a Kubernetes cluster.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>This tutorial requires Kubernetes 1.9 or later. To run the tutorial locally, we recommend using <a href="https://kubernetes.io/docs/getting-started-guides/minikube" target="_blank">minikube</a> in version <code>v0.28+</code> with Kubernetes 1.10 (which is the default).</p>
<h2 id="steps">Steps</h2>
<h3 id="1-start-minikube">1. Start Minikube</h3>
<pre><code class="lang-bash">minikube start
</code></pre>
<h3 id="2-deploy-the-rook-operator">2. Deploy the Rook Operator</h3>
<p>Deploy the Rook system components, which include the <code>Rook agent</code> and <code>Rook operator</code> pods.</p>
<p>Save the operator spec as <strong>operator.yaml</strong>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Namespace
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apiextensions.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CustomResourceDefinition
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> cephclusters.ceph.rook.io
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  group:</span> ceph.rook.io
<span class="hljs-attr">  names:</span>
<span class="hljs-attr">    kind:</span> CephCluster
<span class="hljs-attr">    listKind:</span> CephClusterList
<span class="hljs-attr">    plural:</span> cephclusters
<span class="hljs-attr">    singular:</span> cephcluster
<span class="hljs-attr">  scope:</span> Namespaced
<span class="hljs-attr">  version:</span> v1
<span class="hljs-attr">  validation:</span>
<span class="hljs-attr">    openAPIV3Schema:</span>
<span class="hljs-attr">      properties:</span>
<span class="hljs-attr">        spec:</span>
<span class="hljs-attr">          properties:</span>
<span class="hljs-attr">            cephVersion:</span>
<span class="hljs-attr">              properties:</span>
<span class="hljs-attr">                allowUnsupported:</span>
<span class="hljs-attr">                  type:</span> boolean
<span class="hljs-attr">                image:</span>
<span class="hljs-attr">                  type:</span> string
<span class="hljs-attr">                name:</span>
<span class="hljs-attr">                  pattern:</span> ^(luminous|mimic|nautilus)$
<span class="hljs-attr">                  type:</span> string
<span class="hljs-attr">            dashboard:</span>
<span class="hljs-attr">              properties:</span>
<span class="hljs-attr">                enabled:</span>
<span class="hljs-attr">                  type:</span> boolean
<span class="hljs-attr">                urlPrefix:</span>
<span class="hljs-attr">                  type:</span> string
<span class="hljs-attr">                port:</span>
<span class="hljs-attr">                  type:</span> integer
<span class="hljs-attr">            dataDirHostPath:</span>
<span class="hljs-attr">              pattern:</span> ^/(\S+)
<span class="hljs-attr">              type:</span> string
<span class="hljs-attr">            mon:</span>
<span class="hljs-attr">              properties:</span>
<span class="hljs-attr">                allowMultiplePerNode:</span>
<span class="hljs-attr">                  type:</span> boolean
<span class="hljs-attr">                count:</span>
<span class="hljs-attr">                  maximum:</span> <span class="hljs-number">9</span>
<span class="hljs-attr">                  minimum:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">                  type:</span> integer
<span class="hljs-attr">              required:</span>
<span class="hljs-bullet">              -</span> count
<span class="hljs-attr">            network:</span>
<span class="hljs-attr">              properties:</span>
<span class="hljs-attr">                hostNetwork:</span>
<span class="hljs-attr">                  type:</span> boolean
<span class="hljs-attr">            storage:</span>
<span class="hljs-attr">              properties:</span>
<span class="hljs-attr">                nodes:</span>
<span class="hljs-attr">                  items:</span> {}
<span class="hljs-attr">                  type:</span> array
<span class="hljs-attr">                useAllDevices:</span> {}
<span class="hljs-attr">                useAllNodes:</span>
<span class="hljs-attr">                  type:</span> boolean
<span class="hljs-attr">          required:</span>
<span class="hljs-bullet">          -</span> mon
<span class="hljs-attr">  additionalPrinterColumns:</span>
<span class="hljs-attr">    - name:</span> DataDirHostPath
<span class="hljs-attr">      type:</span> string
<span class="hljs-attr">      description:</span> Directory used on the K8s nodes
<span class="hljs-attr">      JSONPath:</span> .spec.dataDirHostPath
<span class="hljs-attr">    - name:</span> MonCount
<span class="hljs-attr">      type:</span> string
<span class="hljs-attr">      description:</span> Number of MONs
<span class="hljs-attr">      JSONPath:</span> .spec.mon.count
<span class="hljs-attr">    - name:</span> Age
<span class="hljs-attr">      type:</span> date
<span class="hljs-attr">      JSONPath:</span> .metadata.creationTimestamp
<span class="hljs-attr">    - name:</span> State
<span class="hljs-attr">      type:</span> string
<span class="hljs-attr">      description:</span> Current State
<span class="hljs-attr">      JSONPath:</span> .status.state
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apiextensions.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CustomResourceDefinition
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> cephfilesystems.ceph.rook.io
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  group:</span> ceph.rook.io
<span class="hljs-attr">  names:</span>
<span class="hljs-attr">    kind:</span> CephFilesystem
<span class="hljs-attr">    listKind:</span> CephFilesystemList
<span class="hljs-attr">    plural:</span> cephfilesystems
<span class="hljs-attr">    singular:</span> cephfilesystem
<span class="hljs-attr">  scope:</span> Namespaced
<span class="hljs-attr">  version:</span> v1
<span class="hljs-attr">  additionalPrinterColumns:</span>
<span class="hljs-attr">    - name:</span> MdsCount
<span class="hljs-attr">      type:</span> string
<span class="hljs-attr">      description:</span> Number of MDSs
<span class="hljs-attr">      JSONPath:</span> .spec.metadataServer.activeCount
<span class="hljs-attr">    - name:</span> Age
<span class="hljs-attr">      type:</span> date
<span class="hljs-attr">      JSONPath:</span> .metadata.creationTimestamp
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apiextensions.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CustomResourceDefinition
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> cephobjectstores.ceph.rook.io
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  group:</span> ceph.rook.io
<span class="hljs-attr">  names:</span>
<span class="hljs-attr">    kind:</span> CephObjectStore
<span class="hljs-attr">    listKind:</span> CephObjectStoreList
<span class="hljs-attr">    plural:</span> cephobjectstores
<span class="hljs-attr">    singular:</span> cephobjectstore
<span class="hljs-attr">  scope:</span> Namespaced
<span class="hljs-attr">  version:</span> v1
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apiextensions.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CustomResourceDefinition
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> cephobjectstoreusers.ceph.rook.io
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  group:</span> ceph.rook.io
<span class="hljs-attr">  names:</span>
<span class="hljs-attr">    kind:</span> CephObjectStoreUser
<span class="hljs-attr">    listKind:</span> CephObjectStoreUserList
<span class="hljs-attr">    plural:</span> cephobjectstoreusers
<span class="hljs-attr">    singular:</span> cephobjectstoreuser
<span class="hljs-attr">  scope:</span> Namespaced
<span class="hljs-attr">  version:</span> v1
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apiextensions.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CustomResourceDefinition
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> cephblockpools.ceph.rook.io
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  group:</span> ceph.rook.io
<span class="hljs-attr">  names:</span>
<span class="hljs-attr">    kind:</span> CephBlockPool
<span class="hljs-attr">    listKind:</span> CephBlockPoolList
<span class="hljs-attr">    plural:</span> cephblockpools
<span class="hljs-attr">    singular:</span> cephblockpool
<span class="hljs-attr">  scope:</span> Namespaced
<span class="hljs-attr">  version:</span> v1
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apiextensions.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> CustomResourceDefinition
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> volumes.rook.io
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  group:</span> rook.io
<span class="hljs-attr">  names:</span>
<span class="hljs-attr">    kind:</span> Volume
<span class="hljs-attr">    listKind:</span> VolumeList
<span class="hljs-attr">    plural:</span> volumes
<span class="hljs-attr">    singular:</span> volume
<span class="hljs-attr">    shortNames:</span>
<span class="hljs-bullet">    -</span> rv
<span class="hljs-attr">  scope:</span> Namespaced
<span class="hljs-attr">  version:</span> v1alpha2
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> ClusterRole
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-cluster-mgmt
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> secrets
<span class="hljs-bullet">  -</span> pods
<span class="hljs-bullet">  -</span> pods/log
<span class="hljs-bullet">  -</span> services
<span class="hljs-bullet">  -</span> configmaps
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> patch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> extensions
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> deployments
<span class="hljs-bullet">  -</span> daemonsets
<span class="hljs-bullet">  -</span> replicasets
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> Role
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> pods
<span class="hljs-bullet">  -</span> configmaps
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> patch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> extensions
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> daemonsets
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">kind:</span> ClusterRole
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-global
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> pods
<span class="hljs-bullet">  -</span> nodes
<span class="hljs-bullet">  -</span> nodes/proxy
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> events
<span class="hljs-bullet">  -</span> persistentvolumes
<span class="hljs-bullet">  -</span> persistentvolumeclaims
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> patch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> storage.k8s.io
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> storageclasses
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> batch
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> jobs
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> ceph.rook.io
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;*&quot;</span>
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;*&quot;</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> rook.io
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;*&quot;</span>
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;*&quot;</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> ClusterRole
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr-cluster
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> configmaps
<span class="hljs-bullet">  -</span> nodes
<span class="hljs-bullet">  -</span> nodes/proxy
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> ServiceAccount
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> Role
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> ClusterRoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-global
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> ClusterRole
<span class="hljs-attr">  name:</span> rook-ceph-global
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> apps/v1beta1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-operator
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    operator:</span> rook
<span class="hljs-attr">    storage-backend:</span> ceph
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> rook-ceph-operator
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      serviceAccountName:</span> rook-ceph-system
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">      - name:</span> rook-ceph-operator
<span class="hljs-attr">        image:</span> openpolicyagent/rook-operator:latest
<span class="hljs-attr">        args:</span> [<span class="hljs-string">&quot;ceph&quot;</span>, <span class="hljs-string">&quot;operator&quot;</span>]
<span class="hljs-attr">        volumeMounts:</span>
<span class="hljs-attr">        - mountPath:</span> /var/lib/rook
<span class="hljs-attr">          name:</span> rook-config
<span class="hljs-attr">        - mountPath:</span> /etc/ceph
<span class="hljs-attr">          name:</span> default-config-dir
<span class="hljs-attr">        env:</span>
<span class="hljs-attr">        - name:</span> ROOK_ALLOW_MULTIPLE_FILESYSTEMS
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;false&quot;</span>
<span class="hljs-attr">        - name:</span> ROOK_LOG_LEVEL
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;INFO&quot;</span>
<span class="hljs-attr">        - name:</span> ROOK_MON_HEALTHCHECK_INTERVAL
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;45s&quot;</span>
<span class="hljs-attr">        - name:</span> ROOK_MON_OUT_TIMEOUT
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;300s&quot;</span>
<span class="hljs-attr">        - name:</span> ROOK_DISCOVER_DEVICES_INTERVAL
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;60m&quot;</span>
<span class="hljs-attr">        - name:</span> ROOK_HOSTPATH_REQUIRES_PRIVILEGED
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;false&quot;</span>
<span class="hljs-attr">        - name:</span> ROOK_ENABLE_SELINUX_RELABELING
<span class="hljs-attr">          value:</span> <span class="hljs-string">&quot;true&quot;</span>
<span class="hljs-attr">        - name:</span> NODE_NAME
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> spec.nodeName
<span class="hljs-attr">        - name:</span> POD_NAME
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> metadata.name
<span class="hljs-attr">        - name:</span> POD_NAMESPACE
<span class="hljs-attr">          valueFrom:</span>
<span class="hljs-attr">            fieldRef:</span>
<span class="hljs-attr">              fieldPath:</span> metadata.namespace
<span class="hljs-attr">      volumes:</span>
<span class="hljs-attr">      - name:</span> rook-config
<span class="hljs-attr">        emptyDir:</span> {}
<span class="hljs-attr">      - name:</span> default-config-dir
<span class="hljs-attr">        emptyDir:</span> {}
</code></pre>
<p>Create the operator:</p>
<pre><code class="lang-bash">kubectl create <span class="hljs-_">-f</span> operator.yaml
</code></pre>
<p>Verify that <code>rook-ceph-operator</code>, <code>rook-ceph-agent</code>, and <code>rook-discover</code> pods are in the <code>Running</code> state.</p>
<pre><code class="lang-bash">kubectl -n rook-ceph-system get pod
</code></pre>
<blockquote>
<p>The Rook operator image <code>openpolicyagent/rook-operator:latest</code> used in the tutorial supports the latest version of Ceph (<code>nautilus</code>). Rook currently does not support the latest version of Ceph. See <a href="https://github.com/rook/rook/issues/2475" target="_blank">this Github issue</a> for more details.</p>
</blockquote>
<h3 id="3-deploy-opa-on-top-of-kubernetes">3. Deploy OPA on top of Kubernetes</h3>
<p>Save the OPA spec as <strong>opa.yaml</strong>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Namespace
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> opa
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> opa
<span class="hljs-attr">    rook_cluster:</span> rook-ceph
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  type:</span> NodePort
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> opa
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - name:</span> http
<span class="hljs-attr">    protocol:</span> TCP
<span class="hljs-attr">    port:</span> <span class="hljs-number">8181</span>
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">8181</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> extensions/v1beta1
<span class="hljs-attr">kind:</span> Deployment
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> opa
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">  name:</span> opa
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  replicas:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    matchLabels:</span>
<span class="hljs-attr">      app:</span> opa
<span class="hljs-attr">  template:</span>
<span class="hljs-attr">    metadata:</span>
<span class="hljs-attr">      labels:</span>
<span class="hljs-attr">        app:</span> opa
<span class="hljs-attr">      name:</span> opa
<span class="hljs-attr">    spec:</span>
<span class="hljs-attr">      containers:</span>
<span class="hljs-attr">        - name:</span> opa
<span class="hljs-attr">          image:</span> openpolicyagent/opa:<span class="hljs-number">0.10</span><span class="hljs-number">.5</span>
<span class="hljs-attr">          ports:</span>
<span class="hljs-attr">          - name:</span> http
<span class="hljs-attr">            containerPort:</span> <span class="hljs-number">8181</span>
<span class="hljs-attr">          args:</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">&quot;run&quot;</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">&quot;--ignore=.*&quot;</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">&quot;--server&quot;</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">&quot;--log-level=debug&quot;</span>
<span class="hljs-bullet">            -</span> <span class="hljs-string">&quot;/policies/authz.rego&quot;</span>
<span class="hljs-attr">          volumeMounts:</span>
<span class="hljs-attr">            - readOnly:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">              mountPath:</span> /policies
<span class="hljs-attr">              name:</span> authz-policy
<span class="hljs-attr">      volumes:</span>
<span class="hljs-attr">        - name:</span> authz-policy
<span class="hljs-attr">          configMap:</span>
<span class="hljs-attr">            name:</span> authz-policy
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> ConfigMap
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> authz-policy
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">data:</span>
  authz.rego: <span class="hljs-string">|
    package ceph.authz

    default allow = false

    #-----------------------------------------------------------------------------
    # Data structures containing location info about users and buckets.
    # In real-world deployments, these data structures could be loaded into
    # OPA as raw JSON data. The JSON data could also be pulled from external
    # sources like AD, Git, etc.
    #-----------------------------------------------------------------------------

    # user-location information
    user_location = {
        &quot;alice&quot;: &quot;UK&quot;,
        &quot;bob&quot;:   &quot;USA&quot;
    }

    # bucket-location information
    bucket_location = {
        &quot;supersecretbucket&quot;: &quot;USA&quot;
    }

    allow {
        input.method = &quot;HEAD&quot;
        is_user_in_bucket_location(input.user_info.user_id, input.bucket_info.bucket.name)
    }

    allow {
        input.method = &quot;GET&quot;
    }

    allow {
        input.method = &quot;PUT&quot;
        input.user_info.display_name = &quot;Bob&quot;
    }

    allow {
        input.method = &quot;DELETE&quot;
        input.user_info.display_name = &quot;Bob&quot;
    }

    # Check if the user and the bucket being accessed belong to the same
    # location.
    is_user_in_bucket_location(user, bucket) {
        user_location[user] == bucket_location[bucket]
    }
</span></code></pre>
<pre><code class="lang-bash">kubectl apply <span class="hljs-_">-f</span> opa.yaml
</code></pre>
<p>The OPA spec contains a ConfigMap where an OPA policy has been defined. This policy will be used to authorize requests received by the <code>Ceph Object Gateway</code>. More details on this policy will be covered later in the tutorial.</p>
<p>Verify that the OPA pod is <code>Running</code>.</p>
<pre><code class="lang-bash">kubectl -n rook-ceph get pod <span class="hljs-_">-l</span> app=opa
</code></pre>
<h3 id="4-create-a-ceph-cluster">4. Create a Ceph Cluster</h3>
<p>For the cluster to survive reboots, make sure you set the <code>dataDirHostPath</code> property that is valid for your hosts. For minikube, <code>dataDirHostPath</code> is set to <code>/data/rook</code>.</p>
<p>Save the cluster spec as <strong>cluster.yaml</strong>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> ServiceAccount
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-osd
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> ServiceAccount
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> Role
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-osd
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span> [<span class="hljs-string">&quot;&quot;</span>]
<span class="hljs-attr">  resources:</span> [<span class="hljs-string">&quot;configmaps&quot;</span>]
<span class="hljs-attr">  verbs:</span> [ <span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;list&quot;</span>, <span class="hljs-string">&quot;watch&quot;</span>, <span class="hljs-string">&quot;create&quot;</span>, <span class="hljs-string">&quot;update&quot;</span>, <span class="hljs-string">&quot;delete&quot;</span> ]
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> Role
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr-system
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> configmaps
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> Role
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">rules:</span>
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;&quot;</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> pods
<span class="hljs-bullet">  -</span> services
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> batch
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> jobs
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> get
<span class="hljs-bullet">  -</span> list
<span class="hljs-bullet">  -</span> watch
<span class="hljs-bullet">  -</span> create
<span class="hljs-bullet">  -</span> update
<span class="hljs-bullet">  -</span> delete
<span class="hljs-attr">- apiGroups:</span>
<span class="hljs-bullet">  -</span> ceph.rook.io
<span class="hljs-attr">  resources:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;*&quot;</span>
<span class="hljs-attr">  verbs:</span>
<span class="hljs-bullet">  -</span> <span class="hljs-string">&quot;*&quot;</span>
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-cluster-mgmt
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> ClusterRole
<span class="hljs-attr">  name:</span> rook-ceph-cluster-mgmt
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-osd
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> Role
<span class="hljs-attr">  name:</span> rook-ceph-osd
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-osd
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> Role
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr-system
<span class="hljs-attr">  namespace:</span> rook-ceph-system
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> Role
<span class="hljs-attr">  name:</span> rook-ceph-mgr-system
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">kind:</span> RoleBinding
<span class="hljs-attr">apiVersion:</span> rbac.authorization.k8s.io/v1beta1
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-mgr-cluster
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">roleRef:</span>
<span class="hljs-attr">  apiGroup:</span> rbac.authorization.k8s.io
<span class="hljs-attr">  kind:</span> ClusterRole
<span class="hljs-attr">  name:</span> rook-ceph-mgr-cluster
<span class="hljs-attr">subjects:</span>
<span class="hljs-attr">- kind:</span> ServiceAccount
<span class="hljs-attr">  name:</span> rook-ceph-mgr
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-meta">---</span>
<span class="hljs-attr">apiVersion:</span> ceph.rook.io/v1
<span class="hljs-attr">kind:</span> CephCluster
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  cephVersion:</span>
<span class="hljs-attr">    image:</span> ceph/daemon-base:latest-master
<span class="hljs-attr">    allowUnsupported:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  dataDirHostPath:</span> /data/rook
  <span class="hljs-comment"># set the amount of mons to be started</span>
<span class="hljs-attr">  mon:</span>
<span class="hljs-attr">    count:</span> <span class="hljs-number">3</span>
<span class="hljs-attr">    allowMultiplePerNode:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  dashboard:</span>
<span class="hljs-attr">    enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">  network:</span>
<span class="hljs-attr">    hostNetwork:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">  rbdMirroring:</span>
<span class="hljs-attr">    workers:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">  resources:</span>
<span class="hljs-attr">  storage:</span>
<span class="hljs-attr">    useAllNodes:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">    useAllDevices:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">    deviceFilter:</span>
<span class="hljs-attr">    location:</span>
<span class="hljs-attr">    config:</span>
<span class="hljs-attr">      databaseSizeMB:</span> <span class="hljs-string">&quot;1024&quot;</span>
<span class="hljs-attr">      journalSizeMB:</span> <span class="hljs-string">&quot;1024&quot;</span>
<span class="hljs-attr">      osdsPerDevice:</span> <span class="hljs-string">&quot;1&quot;</span>
</code></pre>
<p>Create the cluster:</p>
<pre><code class="lang-bash">kubectl create <span class="hljs-_">-f</span> cluster.yaml
</code></pre>
<p>Make sure the following pods are <code>Running</code>.</p>
<pre><code class="lang-bash">$ kubectl -n rook-ceph get pod
NAME                                   READY     STATUS      RESTARTS   AGE
opa-7458bf7dc6-g72tt                   1/1       Running     0          7m
rook-ceph-mgr<span class="hljs-_">-a</span>-77c8bc845c-t4j9s       1/1       Running     0          4m
rook-ceph-mon<span class="hljs-_">-a</span>-79f5886d9c-mgkpc       1/1       Running     0          5m
rook-ceph-mon-b-68dcffc7cb-xcdts       1/1       Running     0          4m
rook-ceph-mon-c-844f9d4fbd-tz9pn       1/1       Running     0          4m
rook-ceph-osd-0-7479c85878-mbrhd       1/1       Running     0          3m
rook-ceph-osd-prepare-minikube-4mm7c   0/2       Completed   0          4m
</code></pre>
<h3 id="5-configure-ceph-to-use-opa">5. Configure Ceph to use OPA</h3>
<p>The <code>Ceph Object Gateway</code> needs to be configured to use OPA for authorization decisions. The following configuration options are available for the OPA integration with the gateway:</p>
<pre><code class="lang-bash">rgw use opa authz = {use opa server to authorize client requests}
rgw opa url = {opa server url:opa server port}
rgw opa token = {opa bearer token}
rgw opa verify ssl = {verify opa server ssl certificate}
</code></pre>
<p>More information on the OPA - Ceph Object Gateway integration can be found in the Ceph <a href="http://docs.ceph.com/docs/nautilus/radosgw/opa/" target="_blank">docs</a>.</p>
<p>When the Rook Operator creates a cluster, a placeholder ConfigMap is created that can be used to override Ceph&apos;s configuration settings.</p>
<p>Update the ConfigMap to include the OPA-related options.</p>
<pre><code class="lang-bash">kubectl -n rook-ceph edit configmap rook-config-override
</code></pre>
<p>Modify the settings and save.</p>
<pre><code class="lang-bash">data:
  config: |
    [client.radosgw.gateway]
    rgw use opa authz = <span class="hljs-literal">true</span>
    rgw opa url = opa.rook-ceph:8181/v1/data/ceph/authz/allow
</code></pre>
<h3 id="6-create-the-ceph-object-store">6. Create the Ceph Object Store</h3>
<p>Save the object store spec as <strong>object.yaml</strong>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> ceph.rook.io/v1
<span class="hljs-attr">kind:</span> CephObjectStore
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> my-store
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  metadataPool:</span>
<span class="hljs-attr">    failureDomain:</span> host
<span class="hljs-attr">    replicated:</span>
<span class="hljs-attr">      size:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  dataPool:</span>
<span class="hljs-attr">    failureDomain:</span> osd
<span class="hljs-attr">    replicated:</span>
<span class="hljs-attr">      size:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  gateway:</span>
<span class="hljs-attr">    type:</span> s3
<span class="hljs-attr">    sslCertificateRef:</span>
<span class="hljs-attr">    port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    securePort:</span>
<span class="hljs-attr">    instances:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">    allNodes:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">    placement:</span>
<span class="hljs-attr">    resources:</span>
</code></pre>
<pre><code class="lang-bash">kubectl create <span class="hljs-_">-f</span> object.yaml
</code></pre>
<p>When the object store is created, the RGW service with the S3 API will be started in the cluster. The Rook operator will create all the pools and other resources necessary to start the service.</p>
<p>Check that the RGW pod is <code>Running</code>.</p>
<pre><code class="lang-bash">kubectl -n rook-ceph get pod <span class="hljs-_">-l</span> app=rook-ceph-rgw
</code></pre>
<p>Rook sets up the object storage so pods will have access internal to the cluster. Create a new service for external access. We will need the external RGW service for exercising our OPA policy.</p>
<p>Save the external service as <strong>rgw-external.yaml</strong>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> v1
<span class="hljs-attr">kind:</span> Service
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> rook-ceph-rgw-my-store-external
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">  labels:</span>
<span class="hljs-attr">    app:</span> rook-ceph-rgw
<span class="hljs-attr">    rook_cluster:</span> rook-ceph
<span class="hljs-attr">    rook_object_store:</span> my-store
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  ports:</span>
<span class="hljs-attr">  - name:</span> rgw
<span class="hljs-attr">    port:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">    protocol:</span> TCP
<span class="hljs-attr">    targetPort:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  selector:</span>
<span class="hljs-attr">    app:</span> rook-ceph-rgw
<span class="hljs-attr">    rook_cluster:</span> rook-ceph
<span class="hljs-attr">    rook_object_store:</span> my-store
<span class="hljs-attr">  sessionAffinity:</span> None
<span class="hljs-attr">  type:</span> NodePort
</code></pre>
<p>Create the external service.</p>
<pre><code class="lang-bash">kubectl create <span class="hljs-_">-f</span> rgw-external.yaml
</code></pre>
<p>Check that both the <code>internal</code> and <code>external</code> RGW services are <code>Running</code>.</p>
<pre><code class="lang-bash">kubectl -n rook-ceph get service rook-ceph-rgw-my-store rook-ceph-rgw-my-store-external
</code></pre>
<h3 id="7-create-object-store-users">7. Create Object Store Users</h3>
<p>Create two object store users <code>Alice</code> and <code>Bob</code>.</p>
<p><strong>object-user-alice.yaml</strong></p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> ceph.rook.io/v1
<span class="hljs-attr">kind:</span> CephObjectStoreUser
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> alice
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  store:</span> my-store
<span class="hljs-attr">  displayName:</span> <span class="hljs-string">&quot;Alice&quot;</span>
</code></pre>
<p><strong>object-user-bob.yaml</strong></p>
<pre><code class="lang-yaml"><span class="hljs-attr">apiVersion:</span> ceph.rook.io/v1
<span class="hljs-attr">kind:</span> CephObjectStoreUser
<span class="hljs-attr">metadata:</span>
<span class="hljs-attr">  name:</span> bob
<span class="hljs-attr">  namespace:</span> rook-ceph
<span class="hljs-attr">spec:</span>
<span class="hljs-attr">  store:</span> my-store
<span class="hljs-attr">  displayName:</span> <span class="hljs-string">&quot;Bob&quot;</span>
</code></pre>
<p>Now create the users.</p>
<pre><code class="lang-bash">kubectl create <span class="hljs-_">-f</span> object-user-alice.yaml
kubectl create <span class="hljs-_">-f</span> object-user-bob.yaml
</code></pre>
<p>When the object store user is created the Rook operator will create the RGW user on the object store <code>my-store</code>, and store the user&apos;s Access Key and Secret Key in a Kubernetes secret in the namespace <code>rook-ceph</code>.</p>
<h3 id="8-understanding-the-opa-policy">8. Understanding the OPA policy</h3>
<p>As we saw earlier, the OPA spec contained a ConfigMap that defined the policy to be used to authorize requests received by the <code>Ceph Object Gateway</code>. Below is the policy:</p>
<p><strong>authz.rego</strong></p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;python&quot;,&quot;check&quot;:false,&quot;theme&quot;:false}">package ceph.authz

default allow = false

#-----------------------------------------------------------------------------
# Data structures containing location info about users and buckets.
# In real-world deployments, these data structures could be loaded into
# OPA as raw JSON data. The JSON data could also be pulled from external
# sources like AD, Git, etc.
#-----------------------------------------------------------------------------

# user-location information
user_location = {
    &quot;alice&quot;: &quot;UK&quot;,
    &quot;bob&quot;:   &quot;USA&quot;
}

# bucket-location information
bucket_location = {
    &quot;supersecretbucket&quot;: &quot;USA&quot;
}

# Allow access to bucket in same location as user.
allow {
    input.method = &quot;HEAD&quot;
    is_user_in_bucket_location(input.user_info.user_id, input.bucket_info.bucket.name)
}

allow {
    input.method = &quot;GET&quot;
}

allow {
    input.method = &quot;PUT&quot;
    input.user_info.display_name = &quot;Bob&quot;
}

allow {
    input.method = &quot;DELETE&quot;
    input.user_info.display_name = &quot;Bob&quot;
}

# Check if the user and the bucket being accessed belong to the same
# location.
is_user_in_bucket_location(user, bucket) {
    user_location[user] == bucket_location[bucket]
}<br></div></div>

<p><strong>The above policy will restrict a user from accessing a bucket whose location does not match the user&apos;s location.</strong>. The user&apos;s and bucket&apos;s location is hardcoded in the policy for simplicity and in the real-world can be fetched from external sources or pushed into OPA using it&apos;s REST API.</p>
<p>In the above policy, <code>Bob&apos;s</code> location is <code>USA</code> while <code>Alice&apos;s</code> is <code>UK</code>. Since the bucket <code>supersecretbucket</code> is located in the <code>USA</code>, <code>Alice</code> should not be able to access it.</p>
<h3 id="9-create-the-s3-access-test-script">9. Create the S3 access test script</h3>
<p>The below Python S3 access test script connects to the  <code>Ceph Object Store Gateway</code> to perform actions such as creating and deleting buckets. </p>
<blockquote>
<p>You will need to install the <code>python-boto</code> package to run the test script.</p>
</blockquote>
<p>Save the test script as <strong>s3test.py</strong>:</p>
<div class="ace"><div class="aceCode" data-config="{&quot;edit&quot;:false,&quot;lang&quot;:&quot;python&quot;,&quot;check&quot;:false,&quot;theme&quot;:false}">#!/usr/bin/env python

import sys
import boto.s3.connection
from boto.s3.key import Key
import os


def create_bucket(conn, bucket_name):
    try:
        bucket = conn.create_bucket(bucket_name)
    except Exception as e:
        print &apos;Unable to create bucket: Forbidden&apos;


def delete_bucket(conn, bucket_name):
    try:
        bucket = conn.delete_bucket(bucket_name)
    except Exception as e:
        print &apos;Unable to delete bucket: Forbidden&apos;


def list_bucket(conn):
    buckets = conn.get_all_buckets()
    if len(buckets) == 0:
        print &apos;No Buckets&apos;
        return
    for bucket in buckets:
        print &quot;{name} {created}&quot;.format(
            name=bucket.name,
            created=bucket.creation_date,
    )


def upload_data(conn, bucket_name, data):
    bucket = conn.get_bucket(bucket_name)
    k = Key(bucket)
    k.key = &apos;foobar&apos;
    k.set_contents_from_string(data)


def download_data(conn, user, bucket_name):
    try:
        bucket = conn.get_bucket(bucket_name)
    except Exception as e:
        print &apos;Not allowed to access bucket &quot;{}&quot;: User &quot;{}&quot; not in the same location as bucket &quot;{}&quot;&apos;.format(bucket_name, user, bucket_name)
    else:
        k = Key(bucket)
        k.key = &apos;foobar&apos;
        print k.get_contents_as_string()


if __name__ == &apos;__main__&apos;:
    user = sys.argv[1]
    action = sys.argv[2]

    if len(sys.argv) == 4:
        bucket_name = sys.argv[3]

    if len(sys.argv) == 5:
        bucket_name = sys.argv[3]
        data = sys.argv[4]

    access_key_env_name = &apos;{}_ACCESS_KEY&apos;.format(user.upper())
    secret_key_env_name = &apos;{}_SECRET_KEY&apos;.format(user.upper())

    access_key = os.getenv(access_key_env_name)
    secret_key = os.getenv(secret_key_env_name)

    conn = boto.connect_s3(
            aws_access_key_id=access_key,
            aws_secret_access_key=secret_key,
            host=os.getenv(&quot;HOST&quot;), port=int(os.getenv(&quot;PORT&quot;)),
            is_secure=False, calling_format=boto.s3.connection.OrdinaryCallingFormat(),
    )

    if action == &apos;create&apos;:
            create_bucket(conn, bucket_name)

    if action == &apos;list&apos;:
            list_bucket(conn)

    if action == &apos;delete&apos;:
            delete_bucket(conn, bucket_name)

    if action == &apos;upload_data&apos;:
        upload_data(conn, bucket_name, data)

    if action == &apos;download_data&apos;:
        download_data(conn, user, bucket_name)<br></div></div>

<p>The script needs the following environment variables:</p>
<ul>
<li><code>HOST</code> - Hostname of the machine running the RGW service in the cluster.</li>
<li><code>PORT</code> - Port of the RGW service.</li>
<li><code>&lt;USER&gt;_ACCESS_KEY</code> - USER&apos;s <code>ACCESS_KEY</code></li>
<li><code>&lt;USER&gt;_SECRET_KEY</code> - USER&apos;s <code>SECRET_KEY</code></li>
</ul>
<p>We previously created a service to provide external access to the RGW.</p>
<pre><code class="lang-bash">$ kubectl -n rook-ceph get service rook-ceph-rgw-my-store-external
NAME                              TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE
rook-ceph-rgw-my-store-external   NodePort   10.111.198.148   &lt;none&gt;        80:31765/TCP   2h
</code></pre>
<p>Internally the RGW service is running on port <code>80</code>. The external port in this case is <code>31765</code>.</p>
<p>Set the <code>HOST</code> and <code>PORT</code> environment variables:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">export</span> HOST=$(minikube ip)
<span class="hljs-built_in">export</span> PORT=$(kubectl -n rook-ceph get service rook-ceph-rgw-my-store-external -o jsonpath=<span class="hljs-string">&apos;{.spec.ports[?(@.name==&quot;rgw&quot;)].nodePort}&apos;</span>)
</code></pre>
<p>Get Alice&apos;s and Bob&apos;s <code>ACCESS_KEY</code> and <code>SECRET_KEY</code> from the Kubernetes Secret and set the following environment variables:</p>
<pre><code class="lang-bash"><span class="hljs-built_in">export</span> ALICE_ACCESS_KEY=$(kubectl get secret rook-ceph-object-user-my-store-alice -n rook-ceph -o yaml | grep AccessKey | awk <span class="hljs-string">&apos;{print $2}&apos;</span> | base64 --decode)
<span class="hljs-built_in">export</span> ALICE_SECRET_KEY=$(kubectl get secret rook-ceph-object-user-my-store-alice -n rook-ceph -o yaml | grep SecretKey | awk <span class="hljs-string">&apos;{print $2}&apos;</span> | base64 --decode)
<span class="hljs-built_in">export</span> BOB_ACCESS_KEY=$(kubectl get secret rook-ceph-object-user-my-store-bob -n rook-ceph -o yaml | grep AccessKey | awk <span class="hljs-string">&apos;{print $2}&apos;</span> | base64 --decode)
<span class="hljs-built_in">export</span> BOB_SECRET_KEY=$(kubectl get secret rook-ceph-object-user-my-store-bob -n rook-ceph -o yaml | grep SecretKey | awk <span class="hljs-string">&apos;{print $2}&apos;</span> | base64 --decode)
</code></pre>
<p>Now let&apos;s create a bucket and add some data to it.</p>
<ul>
<li><p>First, <code>Bob</code> creates a bucket <code>supersecretbucket</code></p>
<pre><code class="lang-bash">  python s3test.py Bob create supersecretbucket
</code></pre>
</li>
<li><p>List the bucket just created</p>
<pre><code class="lang-bash">  python s3test.py Bob list
</code></pre>
<p>  The output will be something like:</p>
<pre><code class="lang-raw">  supersecretbucket 2019-01-14T21:18:03.872Z
</code></pre>
</li>
<li><p>Add some data to the bucket <code>supersecretbucket</code></p>
<pre><code class="lang-bash">  python s3test.py Bob upload_data supersecretbucket <span class="hljs-string">&quot;This is some secret data&quot;</span>
</code></pre>
</li>
</ul>
<h3 id="10-exercise-the-opa-policy">10. Exercise the OPA policy</h3>
<p>To recap, the policy we are going to test will <strong>restrict a user from accessing a bucket whose location does not match the user&apos;s location.</strong>.</p>
<p>Check that <code>Alice</code> cannot access the contents of the bucket <code>supersecretbucket</code>.</p>
<pre><code class="lang-bash">python s3test.py Alice download_data supersecretbucket
</code></pre>
<p>Since <code>Alice</code> is located in <code>UK</code> and and the bucket <code>supersecretbucket</code> in the <code>USA</code>, she would be denied access.</p>
<p>Check that <code>Bob</code> can access the contents of the bucket <code>supersecretbucket</code>.</p>
<pre><code class="lang-bash">python s3test.py Bob download_data supersecretbucket
</code></pre>
<p>Since <code>Bob</code> and the bucket <code>supersecretbucket</code> are both located in the <code>USA</code>, <code>Bob</code> is granted access to the contents in the bucket.</p>
<h2 id="wrap-up">Wrap Up</h2>
<p>Congratulations for finishing the tutorial!</p>
<p>This tutorial showed how OPA can be used to enforce custom policies over the S3 API to the <code>Ceph Storage Cluster</code>. You can modify OPA&apos;s polices to get greater control over the actions performed on the <code>Ceph Object Storage</code> without making any changes to Ceph.</p>
<p>This tutorial also showed how OPA can seamlessly work with Rook without any modifications to Rook&apos;s components.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class="search-results-count"></span> results matching &quot;<span class="search-query"></span>&quot;</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching &quot;<span class="search-query"></span>&quot;</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="terraform.html" class="navigation navigation-prev " aria-label="Previous page: Terraform Testing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="best-practice-identity.html" class="navigation navigation-next " aria-label="Next page: Identity and User attributes">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Ceph Authorization","level":"2.8","depth":1,"next":{"title":"Identity and User attributes","level":"3.1","depth":1,"path":"best-practice-identity.md","ref":"best-practice-identity.md","articles":[]},"previous":{"title":"Terraform Testing","level":"2.7","depth":1,"path":"terraform.md","ref":"terraform.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["header","addcssjs","collapsible-menu","custom-favicon","ga","-fontsettings","ace"],"pluginsConfig":{"collapsible-menu":{},"ace":{},"search":{},"layout":{"headerPath":"layouts/header.html"},"addcssjs":{"css":[],"js":[]},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"header":{},"highlight":{},"favicon":"images/favicon.png","custom-favicon":{},"ga":{"configuration":"auto","token":"UA-84550302-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"ceph-authorization.md","mtime":"2019-03-08T23:24:37.654Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-03-08T23:25:39.755Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-ace/ace.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    

    

    </body>
</html>

